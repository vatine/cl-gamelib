(in-package #:net.hexapodia.games-2d)

(defvar *xpm-readtable* nil)
(defvar *compiled-xpm-file* "images-xpm.lisp")

(defconstant +xpm-colorchars+
  (if (boundp '+xpm-colorchars+)
      (symbol-value '+xpm-colorchars+)
    '(#\Space #\. #\x #\X #\+ #\@ #\# #\a #\b #\c #\d
      #\e #\f #\g #\h #\i #\j #\k #\l #\m #\n #\o #\p
      #\q #\r #\s #\t #\u #\v #\y #\z #\A #\B #\C #\D
      #\E #\F #\G #\H #\I #\J #\K #\L #\M #\N #\O #\P
      #\Q #\R #\S #\T #\U #\V #\Y #\Z)))

(defun init-readtable ()
  (unless *xpm-readtable*
    (setf *xpm-readtable* (copy-readtable))
    (set-syntax-from-char #\, #\Space *xpm-readtable*)))

(defun read-charspec (f cnt)
  (format nil "泾祜镳骘骝镯忮祜泐泔祆邈蝈徜汨狎姗┅ㄤ彐躅箅轲麒轸弩疳沐ㄦ祜镳骘蝈徜汨狎姗麒殪礤礅弪Ж＼箴徙＼翎猢呼弩＇汨狎僵骈钺祆躅蝈徜汨狎姗┅ㄤ彐躅蝈徜泔祜躜ㄦ戾è泗疱蝈徜汨狎姗┅ㄥ汜箦泗疱ǎ埽戾è蝈徜忉箦倍┅蝈徜姗┅┅ㄤ彐躅蝈徜泱疱篝泐栳箬鏖翳轭瘐舡骝镯篝蜷铉ㄣ篝颟戾è汨狎蝈徜汨狎箴邈泱泐舂┅箅轲麒轸弩疳沐泱戾è蝈徜汨狎泱┅ㄩㄣ栳蚪＼悌戾è泔痱镧箅轲麒轸弩疳沐泱蝈徜泔祜躜泱┅┅箦翩ㄧ弭栳箬汨狎栳箬泔飑ㄥ蝌矧⒄铍铒黝泔祜躜箴邈┅┅┅ㄤ彐躅蝈徜痦ㄦ箴邈ㄩ铋舡蝈徜翎忪濠戾è蝈徜翎忪濯痦蝈徜翎忪濯┅鏖翳镳孱骈戾ㄩ磲珏礤蜱瀛疳翳钺礤骟疱铄舢桢狃镤獒玑礤蟓蹭邯骈戾疳翳轰轵邈糸镱洪铕豸蝈徜扉铄轫徵濠与轲泔眄孱蝈徜扉铄轫徵濠与轲泔溴戾è泔祗疱蝈徜轫徵濠鏖漪桢殓梏ㄣ栳螋徕磲脲栳箬翎忪呼弩＇羼踽飑轫绌鏖翳轭瘐舡骝镯篝蜷铉ㄣ箴邈泔祗疱悌箦翩鏖漪蝈徜泱疱悌箦翩桢殓梏蝈徜泱疱悌戾è泔祜躜蝈徜泱疱悌ㄣ痧蝈徜泱疱悌┅祜镳骘汩骝镯忮祜泔祜躜骘蝈徜轫徵濠滹蝈徜泱疱沭汨狎翎猢箦翩轫磲脲狎蜥扉篝鏖漪桢殓梏┅祜镳骘骝镯忮祜桢殓梏骘扉铄蝈徜轫徵濠滹痱镧鏖翳轭瘐舡骝镯篝蜷铉ㄤ狒扉铄祜镳骘骝镯忮祜鏖漪骘泱蝈徜汨狎箴邈溽翎沭皓滹箦翩ㄡ蝈轫ㄧ弭栳箬泱汨狎翎猢┅┅轫绌┅┅ㄤ彐躅痦礤扉篝祜镳骘轭扉篝麒殪冀瞟殒瞟滹蝈趱蝾舂┅ㄤ彐躅黩轸瀛痦ㄡ蝌狴骖犴濠戾è骟疱疳蝮瀛钺礤篝蜷铉骖犴濠┅躅戾篌篝蜷铉疳翳钺礤豉疱骟疱悌Ⅷ痦箦翩骟疱礤蜱瀛疳翳钺礤磲脲疳翳钺礤呼疱Ⅷ痦骟疱悌┅戾è轫珙犴篚怏糸趱翦＼＼疳翳钺礤钺礤骟疱悌┅麒ㄡ蝌狴溟礤铙轱铙狎蜥┅ㄣ翎磲脲栳箬翎忪濠ㄣ镬铋飑戾èㄦ轵篝麒┅ㄨ箦泔钿麒┅祜镳骘骝镯忮祜滹祜镳骘骝镯忮祜滹戾è泔ㄡ蝈狎蜥┅躅戾篌痦礤泔泔祗箦翩泔祗箫螋ㄣ镱泔泔祗＇缉┅┅祜镳骘汨狎轭痦泔祜蜚栳蝮骘泔轭泔祗滹箦翩ㄧ弭栳箬泔泗徕汨狎┅鏖翳镳孱骈戾ㄩ礴骖犴轰轵邈糸镱猴豸瘐洪姝屮轶趔后躔弪箦溴洪姝滹弩铒舡屮轶恒蝈狒濠ㄦ矧磲轫匦アㄦ矧磲轫Ⅲ翎糸汨狎徇痦圯ア篚怏糸趱翦＼＼轫珙犴濠ㄦ矧磲轫④避ア戾铉翳泔祗┅祜镳骘泔轭泔祗骘汨狎ㄧ弭栳箬泔泗徕麒殪汨狎滹ㄦ矧磲轫④泾沣￣辈О剀ア汨狎＼葬泔飑祜镳骘骝镯忮祜滹黩轸瀛汨狎＼轫绌滹祜镳骘骝镯忮祜滹黩轸瀛汨狎ㄧ弭栳箬ㄡ蝈狎蜥泗徕轫绌殒ū瑭滹ㄦ矧磲轫④ア屐箦滹ㄦ矧磲轫④箕ア┅┅┅ㄤ彐躅蝻翎翦痦ㄩ秕舂戾舄è箫躜沐蝈徜痦轭┅翎蜱弭磲脲狎蜥ㄡ蝌狴溟礤铙轱铙箫躜沐哄戾礤铘豉疱ч铘彗弪洪铋糸犰屐屙孱癌ㄦ轵篝ㄡ蝌狴溟礤铙轱铙箫躜沐┅ㄨ箦泔钿ㄡ蝌狴溟礤铙轱铙箫躜沐┅鞑ǒ博ㄨǒ博┅ㄦ戾è趄犷箧矧戾è澍ō鞑┅ㄤō璨┅戾è犷ㄡ翎澍澌┅篑螋ǐí澍澍í澌澌┅┅戾è钺铉ǐ犷ǒ痖穿┅戾è铠蝻躅ǐ鞑í箝钺铉┅┅铢蝻躅ǐ璨íㄣ矬钺铉┅┅┅ㄩ矧铠癌铢癌冀铠冀铢┅ㄡ蝈箫躜沐铠铢┅┅┅┅祜镳骘忮祜滹祜镳骘忮祜滹箦翩ㄡ蝈翎蜱弭趄犷箧矧┅┅黩轸瀛痦翎蜱弭秕舂┅ㄤ彐躅泔眇殪瀛痦ㄩ瞟戾è箫躜沐蝈徜痦轭┅ㄥ轶麴痱镡瀛骈戾泔眇殪邃痦骈戾┅鏖翳镳孱骈戾ㄣ轫泔眇殪邃痦骈戾轰轵邈糸镱猴豸瘐洪姝屮轶趔横痧孱洪姝滹弩铒舡屮轶恒蝈狒濠躅戾篌屮轶麴ㄦ矧磲汩礴ㄩ瞽疳汶徵恒镯痖戾洵轫徵濠ア┅ㄦ矧磲汩礴ㄤ彐鲠岍ア疳翳钺礤钺礤轭箫躜沐┅┅